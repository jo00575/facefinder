
<html>
<head>
	<meta charset="utf-8">
	<title>Nwagon demo</title>
	<script src="https://cdn.zingchart.com/zingchart.min.js"></script>
	<script src='https://ajax.googleapis.com/ajax/libs/angularjs/1.2.18/angular.js'></script>
	<script src="./columnChart.js"></script>
	<script src="./lineChart.js"></script>
	<script src="./donutChart.js"></script>
	<script>
		var app = angular.module('app', [])
	</script>
	
</head>
<body ng-app='app' onload="nowDate()">

	<div ng-controller='MyCtrl' class='container'>
		<ul>
			<h2 id='testh2'></h2>
		</ul>
		<ul ng-repeat="face in faces" class="list-group-item">
			<h2>현재 관람객: {{face.faceNum}}</h2>
		</ul>
		<ul>
			<h2>총 관람객: {{total.length}}</h2>
		</ul>
		<ul>
			<h2>평균 주시시간: {{stayAvg}}초</h2>
		</ul>
	</div>

	<h2>Column Chart</h2>
	<div ng-controller='ColumnCtrl' class='container' id="chart71">
		<script>
		columnChartMake();
		</script>
	</div>

	<h2>Line Chart</h2>
	<div ng-controller='LineCtrl' id="chart8">
		<script>
			lineChart(function (stayData5,stayData10,stayData15,stayData20, dataLabel){
				var myConfig = {
					"type": "line",
					"plotarea": {
						"adjust-layout": true
					},
					"scale-x": {
						"label": {
							"text": "",
						},
						"labels": dataLabel
					},
					"series": [{
						"values": stayData5
					}, {
						"values": stayData10
					}, {
						"values": stayData15
					}, {
						"values": stayData20
					}]
				};
				zingchart.render({
					id: 'chart8',
					data: myConfig,
					height: '100%',
					width: '100%'
				});
			})
		</script>
	</div>

	<h2>Donut Chart</h2>
	<div ng-controller='DonutCtrl' id="chart_d">
		<script>
		donutChart(function(visit1, visit2, visit3){
				var myConfig = {
					"type": "pie",
					"plot": {
						"value-box": {
							"visible": true,
							"placement": "out",
							"text": "%t <br> Value: %v <br> Percentage: %npv%"
						}
					},
					"series": [{
						"values": visit1,
						"text": "1회 관람"
					}, {
						"values": visit2,
						"text": "2회 관람"
					}, {
						"values": visit3,
						"text": "3회이상 관람"
					}]
				};

				zingchart.render({
					id: 'chart_d',
					data: myConfig,
					height: "100%",
					width: "100%"
				});
			})
		</script>
	</div>
	<script>
		app.controller('MyCtrl', function ($scope, $http){
			$http.get('/faces')
			.success(function (number){
				$scope.faces = number
			})
			$http.get('/totalPeople')
			.success(function (number2){
				$scope.total = number2
				if(number2 > 0){
					var sum = 0;
					for(var i=0; i<number2.length; i++)
						sum = number2[i].stayTime;
					$scope.stayAvg = sum/number2.length;
				}
				else
					$scope.stayAvg = 0;
			})
		})
	</script>
	<script>
	function nowDate(){
		var today = new Date();
		var year = today.getFullYear();
		var month = today.getMonth()+1;
		var date = today.getDate();
		var dayArr = ["(Sun)","(Mon)","(Tue)","(Wen)","(Thu)","(Fri)","(Sat)"];
		var day = today.getDay();
		var hour = today.getHours();
		var min = today.getMinutes();
		//window.alert(day);
		if(month < 10)
			month = "0"+month;
		if(date < 10)
			date = "0"+date;
		if(hour < 10)
			hour = "0"+hour;
		if(min < 10)
			min = "0"+min;
		document.getElementById('testh2').innerHTML = "현재시각: "+year+"-"+month+"-"+date+dayArr[day]+" "+hour+":"+min;
		setTimeout(function(){nowDate()},60000);
	}
	</script>
</body>
</html>
